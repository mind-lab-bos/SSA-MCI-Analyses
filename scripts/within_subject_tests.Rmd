---
title: "correlation_tests"
author: "Nick Kathios"
date: "4/7/2022"
output: html_document
---

```{r}
library(tidyverse)
library(lme4)
library(lmerTest)
```

#read in data
```{r}
childhood_mpfc_auditory <- read.table(file='childhood_mpfc_auditory_mean.csv')
adolescence_mpfc_auditory <- read.table(file='adolescence_mpfc_auditory_mean.csv')
adult_mpfc_auditory <- read.table(file='adulthood_mpfc_auditory_mean.csv')

childhood_mpfc_reward <- read.table(file='childhood_mpfc_reward_mean.csv')
adolescence_mpfc_reward <- read.table(file='adolescence_mpfc_reward_mean.csv')
adult_mpfc_reward <- read.table(file='adulthood_mpfc_reward_mean.csv')

childhood_reward_auditory <- read.table(file='childhood_reward_auditory_mean.csv')
adolescence_reward_auditory <- read.table(file='adolescence_reward_auditory_mean.csv')
adult_reward_auditory <- read.table(file='adulthood_reward_auditory_mean.csv')

childhood_auditory <- read.table(file='childhood_auditory_participant_mean.csv')
adolescence_auditory <- read.table(file='adolescence_auditory_participant_mean.csv')
adult_auditory <- read.table(file='adulthood_auditory_participant_mean.csv')

childhood_reward <- read.table(file='childhood_reward_participant_mean.csv')
adolescence_reward <- read.table(file='adolescence_reward_participant_mean.csv')
adult_reward <- read.table(file='adulthood_reward_participant_mean.csv')

key <- read.csv(file="participant_key.csv")
key$cognitive_health = ifelse(key$cognitive_health=="Healthy","Cognitively Healthy", key$cognitive_health) #recoding some values

```

#cleaning
```{r}
#MPFC - AUDITORY
childhood_mpfc_auditory$time <- "Childhood"
childhood_mpfc_auditory$CONN_ID <- seq(1:30)
adolescence_mpfc_auditory$time <- "Adolescence"
adolescence_mpfc_auditory$CONN_ID <- seq(1:30)
adult_mpfc_auditory$time <- "Adulthood"
adult_mpfc_auditory$CONN_ID <- seq(1:30)
mpfc_auditory <- rbind(childhood_mpfc_auditory, adolescence_mpfc_auditory,
                              adult_mpfc_auditory)
mpfc_auditory <- merge(mpfc_auditory, key, by = "CONN_ID")

mpfc_auditory$time <- factor(mpfc_auditory$time, levels = c("Childhood", "Adolescence", "Adulthood"))


  ggplot(data=mpfc_auditory, aes(x=time, y=V1)) +
  stat_summary(fun.data = 'mean_se', geom = 'errorbar', width = 0.2) +
  stat_summary(fun.data = 'mean_se', geom = 'pointrange') +
  scale_x_discrete(labels=c("Childhood (0-12)", "Adolescence (13-18)",
                            "Adulthood (26-45)")) +
  ylab("Average Fisher-Transformed Correlation Coefficient") +
  xlab("Developmental Time Period")+
   facet_grid(~cognitive_health)

ggsave("../results/mpfc_auditory_plot.png", plot = mpfc_auditory_plot, width=11)

aov <- aov(data=mpfc_auditory, V1 ~ time + Error(SUBID/time))
summary(aov)
test <- lmer(V1 ~ time + (1|SUBID), data=mpfc_auditory)
anova(test)
test.m <- emmeans::emmeans(test, ~time)
A2= c(-1, 3, -1, -1)
emmeans::contrast(test.m, method = list(A2), lmer.df = "satterthwaite")


contrast(test.m, ~time, 'poly') %>%
  broom::tidy()

mpfc_auditory$time <- as.factor(mpfc_auditory$time)

summary(aov, split=list(time=list("Quadratic"=2)))
contrasts(mpfc_auditory$time) <- c(-1, 3, -1, -1)

aov <- aov(data=mpfc_auditory, V1 ~ time + Error(SUBID/time))
aov <- aov(data=mpfc_auditory, V1 ~ time + Error(SUBID/time))
summary(aov)

#MPFC - REWARD (HIGHLIGHT!!)
childhood_mpfc_reward$time <- "Childhood"
childhood_mpfc_reward$CONN_ID <- seq(1:30)
adolescence_mpfc_reward$time <- "Adolescence"
adolescence_mpfc_reward$CONN_ID <- seq(1:30)
adult_mpfc_reward$time <- "Adulthood"
adult_mpfc_reward$CONN_ID <- seq(1:30)
mpfc_reward <- rbind(childhood_mpfc_reward, adolescence_mpfc_reward,
                              adult_mpfc_reward)
mpfc_reward <- merge(mpfc_reward, key, by = "CONN_ID")

mpfc_rewardplot<-
  ggplot(data=mpfc_reward, aes(x=time, y=V1)) +
  stat_summary(fun.data = 'mean_se', geom = 'errorbar', width = 0.2, aes(color=time)) +
  stat_summary(fun.data = 'mean_se', geom = 'pointrange', aes(color=time)) +
  scale_x_discrete(labels=c("Childhood\n(0-12)", "Adolescence\n(13-18)",
                            "Adulthood\n(26-45)")) +
  ylab("Average Fisher-Transformed\nCorrelation Coefficient") +
  xlab("Developmental Time Period")  + 
  facet_grid(~cognitive_health) + 
 theme_classic()+
  theme(legend.position = "none") +
  xlab("Age of Exposure")+
  theme(axis.text=element_text(size=20, face="bold"), axis.title=element_text(size=20,face="bold"), strip.text.x = element_text(size=18,face="bold"), title = element_text(size=22, face="bold")) +
  ggtitle("Average mPFC-Reward Network Connectivity")

ggsave(mpfc_rewardplot, file="mpfc_reward.png", dpi=350, width=12)


aov <- aov(data=mpfc_reward, V1 ~ time + Error(SUBID/time))
summary(aov)

test <- lmer(V1 ~ time + (1|SUBID), data=mpfc_reward)
anova(test)

#REWARD-REWARD -- HIGHLIGHT MCI?
childhood_reward$time <- "Childhood"
childhood_reward$CONN_ID <- seq(1:30)
adolescence_reward$time <- "Adolescence"
adolescence_reward$CONN_ID <- seq(1:30)
adult_reward$time <- "Adulthood"
adult_reward$CONN_ID <- seq(1:30)
reward <- rbind(childhood_reward, adolescence_reward,
                              adult_reward)
reward <- merge(reward, key, by = "CONN_ID")

test <- lmer(V1 ~ time + (1|SUBID), data=reward)
anova(test)

ggplot(data=reward, aes(x=time, y=V1)) +
  stat_summary(fun.data = 'mean_se', geom = 'errorbar', width = 0.2) +
  stat_summary(fun.data = 'mean_se', geom = 'pointrange') +
  scale_x_discrete(labels=c("Childhood (0-12)", "Adolescence (13-18)",
                            "Adulthood (26-45)")) +
  ylab("Average Fisher-Transformed Correlation Coefficient") +
  xlab("Developmental Time Period") +
        theme(
    axis.title.x = element_text(size=18, family="Arial",face="bold"),
    axis.title.y = element_text(size=18, family="Arial", face="bold"),
    axis.text.y = element_text(size=14, family="Arial"), 
    axis.text.x = element_text(size=14, family="Arial"),
    strip.text.x = element_text(size=12,family="Arial")
  ) +
   facet_grid(~cognitive_health)

#AUDITORY - REWARD --> highlight MCI
childhood_reward_auditory$time <- "Childhood"
childhood_reward_auditory$CONN_ID <- seq(1:30)
adolescence_reward_auditory$time <- "Adolescence"
adolescence_reward_auditory$CONN_ID <- seq(1:30)
adult_reward_auditory$time <- "Adulthood"
adult_reward_auditory$CONN_ID <- seq(1:30)
reward_auditory <- rbind(childhood_reward_auditory, adolescence_reward_auditory,
                              adult_reward_auditory)
reward_auditory <- merge(reward_auditory, key, by = "CONN_ID")

test <- lmer(V1 ~ time + (1|SUBID), data=reward_auditory)
anova(test)

reward_auditory<-
  ggplot(data=reward_auditory, aes(x=time, y=V1)) +
  stat_summary(fun.data = 'mean_se', geom = 'errorbar', width = 0.2, aes(color=time)) +
  stat_summary(fun.data = 'mean_se', geom = 'pointrange',aes(color=time)) +
  scale_x_discrete(labels=c("Childhood\n(0-12)", "Adolescence\n(13-18)",
                            "Adulthood\n(26-45)")) +
  ylab("Average Fisher-Transformed\nCorrelation Coefficient") +
  xlab("Developmental Time Period") +
   facet_grid(~cognitive_health) +
  theme_classic()+
  theme(legend.position = "none") +
  xlab("Age of Exposure")+
  theme(axis.text=element_text(size=20, face="bold"), axis.title=element_text(size=20,face="bold"), strip.text.x = element_text(size=18,face="bold"), title = element_text(size=22, face="bold")) +
  ggtitle("Average Auditory-Reward Network Connectivity")

ggsave(reward_auditory, file="reward_auditory.png", dpi=350, width=12)


#AUDITORY - AUDITORY
childhood_auditory$time <- "Childhood"
childhood_auditory$CONN_ID <- seq(1:30)
adolescence_auditory$time <- "Adolescence"
adolescence_auditory$CONN_ID <- seq(1:30)
adult_auditory$time <- "Adulthood"
adult_auditory$CONN_ID <- seq(1:30)
auditory <- rbind(childhood_auditory, adolescence_auditory,
                              adult_auditory)
auditory <- merge(auditory, key, by = "CONN_ID")

test <- lmer(V1 ~ time + (1|SUBID), data=auditory)
anova(test)

ggplot(data=auditory, aes(x=time, y=V1)) +
  stat_summary(fun.data = 'mean_se', geom = 'errorbar', width = 0.2) +
  stat_summary(fun.data = 'mean_se', geom = 'pointrange') +
  scale_x_discrete(labels=c("Childhood (0-12)", "Adolescence (13-18)",
                            "Adulthood (26-45)")) +
  ylab("Average Fisher-Transformed Correlation Coefficient") +
  xlab("Developmental Time Period") +
        theme(
    axis.title.x = element_text(size=18, family="Arial",face="bold"),
    axis.title.y = element_text(size=18, family="Arial", face="bold"),
    axis.text.y = element_text(size=14, family="Arial"), 
    axis.text.x = element_text(size=14, family="Arial"),
    strip.text.x = element_text(size=12,family="Arial")
  ) +
   facet_grid(~cognitive_health)
```
